% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\newsavebox\pandoc@box
\newcommand*\pandocbounded[1]{% scales image to fit in text height/width
  \sbox\pandoc@box{#1}%
  \Gscale@div\@tempa{\textheight}{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
  \Gscale@div\@tempb{\linewidth}{\wd\pandoc@box}%
  \ifdim\@tempb\p@<\@tempa\p@\let\@tempa\@tempb\fi% select the smaller of both
  \ifdim\@tempa\p@<\p@\scalebox{\@tempa}{\usebox\pandoc@box}%
  \else\usebox{\pandoc@box}%
  \fi%
}
% Set default figure placement to htbp
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Analisis USD/PEN},
  pdfauthor={N. Leon},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Analisis USD/PEN}
\author{N. Leon}
\date{2026-01-13}

\begin{document}
\maketitle

\section{Introducción}\label{introducciuxf3n}

La hipótesis de esta (breve y rápida investigación) es:

\begin{quote}
«El tipo de cambio USD/PEN se aprecia en los N días previos a las
elecciones y se deprecia en los N días posteriores a las elecciones».
\end{quote}

siendo N=\textbf{15, 30, 60, 90, 120 días} antes y después.

El razonamiento es que -desde la instauración de la República
Empresarial- las segundas vueltas electorales han sido marcadas por una
campana mediática polarizante entre un/a candidato/a de ``derecha'' y
otro/a candidato/a de ``izquierda''. Esta polarización altera
exógenamente el mercado y los individuos tienden hacia una posición
conservadora por la cual compran dólares para protegerse de un posible
derrumbe económico, en caso gane un/a candidato/a de ``izquierda''. Esto
se debe a la gran concentración de medios en el país que informa
directamente a los individuos con mayor capacidad de gasto y ahorro, es
decir, a las clases A y B del país, que son -por su mayoría y capacidad
de gasto- los individuos que más dólares pueden comprar. Al mismo
tiempo, al ser el Banco Central de Reserva independiente, este no
interviene rápidamente para reducir (o aumentar) el tipo de cambio, sino
que prefiere esperar a una reducción paulativa del miedo generalizado,
lo que lleva -casi naturalmente- a una reducción en el tipo de cambio,
permitiendo esta seasonality.

\section{Settings}\label{settings}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load required libraries}
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --
## v dplyr     1.1.4     v readr     2.1.5
## v forcats   1.0.0     v stringr   1.5.1
## v ggplot2   3.5.2     v tibble    3.3.0
## v lubridate 1.9.4     v tidyr     1.3.1
## v purrr     1.1.0     
## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
## i Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(summariser)}
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(lubridate)}
\FunctionTok{library}\NormalTok{(quantmod)     }\CommentTok{\# For financial data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: xts
## Loading required package: zoo
## 
## Attaching package: 'zoo'
## 
## The following objects are masked from 'package:base':
## 
##     as.Date, as.Date.numeric
## 
## 
## ######################### Warning from 'xts' package ##########################
## #                                                                             #
## # The dplyr lag() function breaks how base R's lag() function is supposed to  #
## # work, which breaks lag(my_xts). Calls to lag(my_xts) that you type or       #
## # source() into this session won't work correctly.                            #
## #                                                                             #
## # Use stats::lag() to make sure you're not using dplyr::lag(), or you can add #
## # conflictRules('dplyr', exclude = 'lag') to your .Rprofile to stop           #
## # dplyr from breaking base R's lag() function.                                #
## #                                                                             #
## # Code in packages is not affected. It's protected by R's namespace mechanism #
## # Set `options(xts.warn_dplyr_breaks_lag = FALSE)` to suppress this warning.  #
## #                                                                             #
## ###############################################################################
## 
## Attaching package: 'xts'
## 
## The following objects are masked from 'package:dplyr':
## 
##     first, last
## 
## Loading required package: TTR
## Registered S3 method overwritten by 'quantmod':
##   method            from
##   as.zoo.data.frame zoo
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(knitr)        }\CommentTok{\# For nice tables}
\FunctionTok{library}\NormalTok{(scales)       }\CommentTok{\# For percentage formatting}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'scales'
## 
## The following object is masked from 'package:purrr':
## 
##     discard
## 
## The following object is masked from 'package:readr':
## 
##     col_factor
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggrepel)      }\CommentTok{\# For better label placement}
\FunctionTok{library}\NormalTok{(patchwork)    }\CommentTok{\# For combining plots}

\CommentTok{\# Set random seed for reproducibility}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}

\CommentTok{\# Set plotting theme}
\FunctionTok{theme\_set}\NormalTok{(}\FunctionTok{theme\_minimal}\NormalTok{(}\AttributeTok{base\_size =} \DecValTok{12}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\section{Preprocesamiento}\label{preprocesamiento}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_ex\_ra }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/exchange\_rate.csv"}\NormalTok{, }\AttributeTok{header =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{sep =} \StringTok{","}\NormalTok{, }\AttributeTok{dec =} \StringTok{"."}\NormalTok{,)}
\NormalTok{df\_ex\_ra}\SpecialCharTok{$}\NormalTok{value }\OtherTok{\textless{}{-}} \FunctionTok{as.double}\NormalTok{(df\_ex\_ra}\SpecialCharTok{$}\NormalTok{value)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: NAs introduced by coercion
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_ex\_ra}\SpecialCharTok{$}\NormalTok{date }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(df\_ex\_ra}\SpecialCharTok{$}\NormalTok{date, }\StringTok{"\%d.\%m.\%y"}\NormalTok{)}
\FunctionTok{summary}\NormalTok{(df\_ex\_ra)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       date                value      
##  Min.   :2004-01-19   Min.   :2.537  
##  1st Qu.:2009-07-16   1st Qu.:2.906  
##  Median :2015-01-14   Median :3.265  
##  Mean   :2015-01-14   Mean   :3.252  
##  3rd Qu.:2020-07-13   3rd Qu.:3.488  
##  Max.   :2026-01-09   Max.   :4.137  
##                       NA's   :263
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_elect }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/elections.csv"}\NormalTok{, }\AttributeTok{header =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{sep =} \StringTok{","}\NormalTok{, }\AttributeTok{dec =} \StringTok{"."}\NormalTok{,)}
\NormalTok{df\_elect}\SpecialCharTok{$}\NormalTok{date }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(df\_elect}\SpecialCharTok{$}\NormalTok{date, }\StringTok{"\%d.\%m.\%y"}\NormalTok{)}
\FunctionTok{summary}\NormalTok{(df\_elect)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       date                type              loser              winner         
##  Min.   :2006-06-04   Length:4           Length:4           Length:4          
##  1st Qu.:2010-03-05   Class :character   Class :character   Class :character  
##  Median :2013-12-04   Mode  :character   Mode  :character   Mode  :character  
##  Mean   :2013-12-04                                                           
##  3rd Qu.:2017-09-04                                                           
##  Max.   :2021-06-06
\end{verbatim}

\section{Visualización}\label{visualizaciuxf3n}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{data =}\NormalTok{ df\_ex\_ra, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ date, }\AttributeTok{y =}\NormalTok{ value), }
            \AttributeTok{color =} \StringTok{"steelblue"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.7}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{data =}\NormalTok{ df\_elect, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{xintercept =}\NormalTok{ date), }
             \AttributeTok{color =} \StringTok{"red"}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"USD/PEN Exchange Rate with Election Dates"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"Date"}\NormalTok{, }\AttributeTok{y =} \StringTok{"USD/PEN"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_date}\NormalTok{(}\AttributeTok{date\_labels =} \StringTok{"\%Y"}\NormalTok{, }\AttributeTok{date\_breaks =} \StringTok{"2 years"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{))}
\FunctionTok{print}\NormalTok{(p1)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{main_files/figure-latex/plot1-1.pdf}}

\section{Función}\label{funciuxf3n}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Function to calculate returns for specific windows around elections}
\NormalTok{calculate\_window\_returns }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df\_exchange, df\_elections, window\_days) \{}
\NormalTok{  results }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
  
  \CommentTok{\# Get election dates from the elections dataframe}
\NormalTok{  election\_dates }\OtherTok{\textless{}{-}}\NormalTok{ df\_elections}\SpecialCharTok{$}\NormalTok{date}
  
  \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \FunctionTok{seq\_along}\NormalTok{(election\_dates)) \{}
\NormalTok{    election\_date }\OtherTok{\textless{}{-}}\NormalTok{ election\_dates[i]}
    
    \CommentTok{\# Find index position in exchange rate data}
    \CommentTok{\# We need to find the closest trading day to the election date}
    \CommentTok{\# Since election dates might not be trading days}
\NormalTok{    date\_diffs }\OtherTok{\textless{}{-}} \FunctionTok{abs}\NormalTok{(df\_exchange}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{{-}}\NormalTok{ election\_date)}
\NormalTok{    election\_idx }\OtherTok{\textless{}{-}} \FunctionTok{which.min}\NormalTok{(date\_diffs)}
\NormalTok{    closest\_date }\OtherTok{\textless{}{-}}\NormalTok{ df\_exchange}\SpecialCharTok{$}\NormalTok{date[election\_idx]}
    
    \CommentTok{\# Check if the closest date is within a reasonable range (e.g., 7 days)}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{difftime}\NormalTok{(closest\_date, election\_date, }\AttributeTok{units =} \StringTok{"days"}\NormalTok{)) }\SpecialCharTok{\textgreater{}} \DecValTok{7}\NormalTok{) \{}
      \FunctionTok{warning}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"No exchange rate data found within 7 days of election date:"}\NormalTok{, }
\NormalTok{                    election\_date))}
      \ControlFlowTok{next}
\NormalTok{    \}}
    
    \CommentTok{\# Pre{-}election window: from N days before to 1 day before election}
    \CommentTok{\# We need to find the actual trading days}
    
    \CommentTok{\# Find pre{-}election window start (N trading days before)}
\NormalTok{    pre\_window\_start\_date }\OtherTok{\textless{}{-}}\NormalTok{ election\_date }\SpecialCharTok{{-}}\NormalTok{ window\_days}
    
    \CommentTok{\# Find the closest trading day to pre\_window\_start\_date}
\NormalTok{    pre\_diffs }\OtherTok{\textless{}{-}} \FunctionTok{abs}\NormalTok{(df\_exchange}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{{-}}\NormalTok{ pre\_window\_start\_date)}
\NormalTok{    pre\_start\_idx }\OtherTok{\textless{}{-}} \FunctionTok{which.min}\NormalTok{(pre\_diffs)}
\NormalTok{    pre\_start\_date }\OtherTok{\textless{}{-}}\NormalTok{ df\_exchange}\SpecialCharTok{$}\NormalTok{date[pre\_start\_idx]}
    
    \CommentTok{\# Find pre{-}election window end (1 trading day before election)}
    \CommentTok{\# Look for dates before election date}
\NormalTok{    dates\_before }\OtherTok{\textless{}{-}}\NormalTok{ df\_exchange}\SpecialCharTok{$}\NormalTok{date[df\_exchange}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{\textless{}}\NormalTok{ election\_date]}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(dates\_before) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
      \FunctionTok{warning}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"No exchange rate data before election date:"}\NormalTok{, election\_date))}
      \ControlFlowTok{next}
\NormalTok{    \}}
\NormalTok{    pre\_end\_date }\OtherTok{\textless{}{-}} \FunctionTok{max}\NormalTok{(dates\_before)}
\NormalTok{    pre\_end\_idx }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(df\_exchange}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{==}\NormalTok{ pre\_end\_date)}
    
    \CommentTok{\# Post{-}election window: from 1 day after to N days after}
    \CommentTok{\# Find post{-}election window start (1 trading day after election)}
\NormalTok{    dates\_after }\OtherTok{\textless{}{-}}\NormalTok{ df\_exchange}\SpecialCharTok{$}\NormalTok{date[df\_exchange}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{\textgreater{}}\NormalTok{ election\_date]}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(dates\_after) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
      \FunctionTok{warning}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"No exchange rate data after election date:"}\NormalTok{, election\_date))}
      \ControlFlowTok{next}
\NormalTok{    \}}
\NormalTok{    post\_start\_date }\OtherTok{\textless{}{-}} \FunctionTok{min}\NormalTok{(dates\_after)}
\NormalTok{    post\_start\_idx }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(df\_exchange}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{==}\NormalTok{ post\_start\_date)}
    
    \CommentTok{\# Find post{-}election window end (N trading days after)}
\NormalTok{    post\_window\_end\_date }\OtherTok{\textless{}{-}}\NormalTok{ election\_date }\SpecialCharTok{+}\NormalTok{ window\_days}
    
    \CommentTok{\# Find the closest trading day to post\_window\_end\_date}
\NormalTok{    post\_diffs }\OtherTok{\textless{}{-}} \FunctionTok{abs}\NormalTok{(df\_exchange}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{{-}}\NormalTok{ post\_window\_end\_date)}
\NormalTok{    post\_end\_idx }\OtherTok{\textless{}{-}} \FunctionTok{which.min}\NormalTok{(post\_diffs)}
\NormalTok{    post\_end\_date }\OtherTok{\textless{}{-}}\NormalTok{ df\_exchange}\SpecialCharTok{$}\NormalTok{date[post\_end\_idx]}
    
    \CommentTok{\# Ensure indices are within bounds}
    \ControlFlowTok{if}\NormalTok{(pre\_start\_idx }\SpecialCharTok{\textgreater{}=} \DecValTok{1} \SpecialCharTok{\&\&}\NormalTok{ pre\_start\_idx }\SpecialCharTok{\textless{}=} \FunctionTok{nrow}\NormalTok{(df\_exchange) }\SpecialCharTok{\&\&}
\NormalTok{       pre\_end\_idx }\SpecialCharTok{\textgreater{}=} \DecValTok{1} \SpecialCharTok{\&\&}\NormalTok{ pre\_end\_idx }\SpecialCharTok{\textless{}=} \FunctionTok{nrow}\NormalTok{(df\_exchange) }\SpecialCharTok{\&\&}
\NormalTok{       post\_start\_idx }\SpecialCharTok{\textgreater{}=} \DecValTok{1} \SpecialCharTok{\&\&}\NormalTok{ post\_start\_idx }\SpecialCharTok{\textless{}=} \FunctionTok{nrow}\NormalTok{(df\_exchange) }\SpecialCharTok{\&\&}
\NormalTok{       post\_end\_idx }\SpecialCharTok{\textgreater{}=} \DecValTok{1} \SpecialCharTok{\&\&}\NormalTok{ post\_end\_idx }\SpecialCharTok{\textless{}=} \FunctionTok{nrow}\NormalTok{(df\_exchange)) \{}
      
\NormalTok{      pre\_start\_price }\OtherTok{\textless{}{-}}\NormalTok{ df\_exchange}\SpecialCharTok{$}\NormalTok{value[pre\_start\_idx]}
\NormalTok{      pre\_end\_price }\OtherTok{\textless{}{-}}\NormalTok{ df\_exchange}\SpecialCharTok{$}\NormalTok{value[pre\_end\_idx]}
      
\NormalTok{      post\_start\_price }\OtherTok{\textless{}{-}}\NormalTok{ df\_exchange}\SpecialCharTok{$}\NormalTok{value[post\_start\_idx]}
\NormalTok{      post\_end\_price }\OtherTok{\textless{}{-}}\NormalTok{ df\_exchange}\SpecialCharTok{$}\NormalTok{value[post\_end\_idx]}
      
      \CommentTok{\# Calculate percentage returns}
\NormalTok{      pre\_return }\OtherTok{\textless{}{-}}\NormalTok{ (pre\_end\_price }\SpecialCharTok{{-}}\NormalTok{ pre\_start\_price) }\SpecialCharTok{/}\NormalTok{ pre\_start\_price }\SpecialCharTok{*} \DecValTok{100}
\NormalTok{      post\_return }\OtherTok{\textless{}{-}}\NormalTok{ (post\_end\_price }\SpecialCharTok{{-}}\NormalTok{ post\_start\_price) }\SpecialCharTok{/}\NormalTok{ post\_start\_price }\SpecialCharTok{*} \DecValTok{100}
      
      \CommentTok{\# Calculate actual number of calendar days in each window}
\NormalTok{      pre\_calendar\_days }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{difftime}\NormalTok{(pre\_end\_date, pre\_start\_date, }\AttributeTok{units =} \StringTok{"days"}\NormalTok{))}
\NormalTok{      post\_calendar\_days }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{difftime}\NormalTok{(post\_end\_date, post\_start\_date, }\AttributeTok{units =} \StringTok{"days"}\NormalTok{))}
      
\NormalTok{      results[[i]] }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
        \AttributeTok{election\_id =}\NormalTok{ i,}
        \AttributeTok{election\_date =}\NormalTok{ election\_date,}
        \AttributeTok{election\_type =} \FunctionTok{ifelse}\NormalTok{(}\StringTok{"type"} \SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(df\_elections), }
\NormalTok{                              df\_elections}\SpecialCharTok{$}\NormalTok{type[i], }\StringTok{"Presidential"}\NormalTok{),}
        \AttributeTok{window\_days =}\NormalTok{ window\_days,}
        \AttributeTok{pre\_start\_date =}\NormalTok{ pre\_start\_date,}
        \AttributeTok{pre\_end\_date =}\NormalTok{ pre\_end\_date,}
        \AttributeTok{post\_start\_date =}\NormalTok{ post\_start\_date,}
        \AttributeTok{post\_end\_date =}\NormalTok{ post\_end\_date,}
        \AttributeTok{pre\_calendar\_days =}\NormalTok{ pre\_calendar\_days,}
        \AttributeTok{post\_calendar\_days =}\NormalTok{ post\_calendar\_days,}
        \AttributeTok{pre\_start\_price =}\NormalTok{ pre\_start\_price,}
        \AttributeTok{pre\_end\_price =}\NormalTok{ pre\_end\_price,}
        \AttributeTok{post\_start\_price =}\NormalTok{ post\_start\_price,}
        \AttributeTok{post\_end\_price =}\NormalTok{ post\_end\_price,}
        \AttributeTok{pre\_return\_pct =}\NormalTok{ pre\_return,}
        \AttributeTok{post\_return\_pct =}\NormalTok{ post\_return,}
        \AttributeTok{net\_effect =}\NormalTok{ pre\_return }\SpecialCharTok{{-}}\NormalTok{ post\_return,}
        \CommentTok{\# Annualized returns for comparison across different window lengths}
        \AttributeTok{pre\_annualized =} \FunctionTok{ifelse}\NormalTok{(pre\_calendar\_days }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, }
\NormalTok{                               (}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ pre\_return}\SpecialCharTok{/}\DecValTok{100}\NormalTok{)}\SpecialCharTok{\^{}}\NormalTok{(}\DecValTok{365}\SpecialCharTok{/}\NormalTok{pre\_calendar\_days) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{,}
                               \ConstantTok{NA}\NormalTok{),}
        \AttributeTok{post\_annualized =} \FunctionTok{ifelse}\NormalTok{(post\_calendar\_days }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{,}
\NormalTok{                                (}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ post\_return}\SpecialCharTok{/}\DecValTok{100}\NormalTok{)}\SpecialCharTok{\^{}}\NormalTok{(}\DecValTok{365}\SpecialCharTok{/}\NormalTok{post\_calendar\_days) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{,}
                                \ConstantTok{NA}\NormalTok{)}
\NormalTok{      )}
\NormalTok{    \}}
\NormalTok{  \}}
  
  \CommentTok{\# Combine all elections for this window}
  \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(results) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
    \FunctionTok{bind\_rows}\NormalTok{(results)}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \FunctionTok{tibble}\NormalTok{()  }\CommentTok{\# Return empty tibble if no results}
\NormalTok{  \}}
\NormalTok{\}}

\CommentTok{\# Wrapper function to calculate for multiple windows}
\NormalTok{calculate\_all\_windows }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df\_exchange, df\_elections, }\AttributeTok{windows =} \FunctionTok{c}\NormalTok{(}\DecValTok{15}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{60}\NormalTok{, }\DecValTok{90}\NormalTok{, }\DecValTok{120}\NormalTok{)) \{}
\NormalTok{  all\_results }\OtherTok{\textless{}{-}} \FunctionTok{map\_df}\NormalTok{(windows, }\SpecialCharTok{\textasciitilde{}}\FunctionTok{calculate\_window\_returns}\NormalTok{(df\_exchange, df\_elections, .x))}
  
  \CommentTok{\# Add some additional metrics}
\NormalTok{  all\_results }\OtherTok{\textless{}{-}}\NormalTok{ all\_results }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(window\_days) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}
      \AttributeTok{pre\_rank =} \FunctionTok{rank}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{pre\_return\_pct),  }\CommentTok{\# Rank by pre{-}return (highest = 1)}
      \AttributeTok{post\_rank =} \FunctionTok{rank}\NormalTok{(post\_return\_pct)   }\CommentTok{\# Rank by post{-}return (lowest = 1)}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{ungroup}\NormalTok{()}
  
  \FunctionTok{return}\NormalTok{(all\_results)}
\NormalTok{\}}

\CommentTok{\# Ensure exchange rate data is sorted}
\NormalTok{df\_ex\_ra }\OtherTok{\textless{}{-}}\NormalTok{ df\_ex\_ra }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(date)}

\CommentTok{\# Calculate returns for all windows}
\NormalTok{windows }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{15}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{60}\NormalTok{, }\DecValTok{90}\NormalTok{, }\DecValTok{120}\NormalTok{)}
\NormalTok{all\_results }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_all\_windows}\NormalTok{(df\_ex\_ra, df\_elect, windows)}

\CommentTok{\# View results}
\FunctionTok{cat}\NormalTok{(}\StringTok{"All window results:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## All window results:
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{head}\NormalTok{(all\_results))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 21
##   election_id election_date election_type window_days pre_start_date
##         <int> <date>        <chr>               <dbl> <date>        
## 1           1 2006-06-04    normal                 15 2006-05-19    
## 2           2 2011-06-05    normal                 15 2011-05-20    
## 3           3 2016-06-05    normal                 15 2016-05-20    
## 4           4 2021-06-06    normal                 15 2021-05-21    
## 5           1 2006-06-04    normal                 30 2006-05-05    
## 6           2 2011-06-05    normal                 30 2011-05-06    
## # i 16 more variables: pre_end_date <date>, post_start_date <date>,
## #   post_end_date <date>, pre_calendar_days <dbl>, post_calendar_days <dbl>,
## #   pre_start_price <dbl>, pre_end_price <dbl>, post_start_price <dbl>,
## #   post_end_price <dbl>, pre_return_pct <dbl>, post_return_pct <dbl>,
## #   net_effect <dbl>, pre_annualized <dbl>, post_annualized <dbl>,
## #   pre_rank <dbl>, post_rank <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create summary statistics}
\NormalTok{summary\_table }\OtherTok{\textless{}{-}}\NormalTok{ all\_results }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(window\_days) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{n\_elections =} \FunctionTok{n}\NormalTok{(),}
    \AttributeTok{avg\_pre\_return =} \FunctionTok{mean}\NormalTok{(pre\_return\_pct, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{median\_pre\_return =} \FunctionTok{median}\NormalTok{(pre\_return\_pct, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{sd\_pre\_return =} \FunctionTok{sd}\NormalTok{(pre\_return\_pct, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_post\_return =} \FunctionTok{mean}\NormalTok{(post\_return\_pct, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{median\_post\_return =} \FunctionTok{median}\NormalTok{(post\_return\_pct, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{sd\_post\_return =} \FunctionTok{sd}\NormalTok{(post\_return\_pct, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{pre\_positive\_pct =} \FunctionTok{mean}\NormalTok{(pre\_return\_pct }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{*} \DecValTok{100}\NormalTok{,}
    \AttributeTok{post\_negative\_pct =} \FunctionTok{mean}\NormalTok{(post\_return\_pct }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{*} \DecValTok{100}\NormalTok{,}
    \AttributeTok{avg\_net\_effect =} \FunctionTok{mean}\NormalTok{(net\_effect, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\FunctionTok{across}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric), }\SpecialCharTok{\textasciitilde{}}\FunctionTok{round}\NormalTok{(., }\DecValTok{3}\NormalTok{)))}

\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Summary Statistics:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Summary Statistics:
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{kable}\NormalTok{(summary\_table)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}
  >{\raggedleft\arraybackslash}p{(\linewidth - 20\tabcolsep) * \real{0.0702}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 20\tabcolsep) * \real{0.0702}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 20\tabcolsep) * \real{0.0877}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 20\tabcolsep) * \real{0.1053}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 20\tabcolsep) * \real{0.0819}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 20\tabcolsep) * \real{0.0936}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 20\tabcolsep) * \real{0.1111}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 20\tabcolsep) * \real{0.0877}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 20\tabcolsep) * \real{0.0994}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 20\tabcolsep) * \real{0.1053}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 20\tabcolsep) * \real{0.0877}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedleft
window\_days
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_elections
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
avg\_pre\_return
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
median\_pre\_return
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
sd\_pre\_return
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
avg\_post\_return
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
median\_post\_return
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
sd\_post\_return
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
pre\_positive\_pct
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
post\_negative\_pct
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
avg\_net\_effect
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
15 & 4 & 0.702 & 0.214 & 1.103 & -0.260 & -0.144 & 0.808 & 100 & 50 &
0.962 \\
30 & 4 & -0.145 & 0.013 & 1.093 & -0.411 & -0.315 & 0.893 & 50 & 50 &
0.265 \\
60 & 4 & 0.007 & -1.731 & 4.324 & 0.500 & 0.194 & 2.180 & 25 & 50 &
-0.493 \\
90 & 4 & -0.458 & -1.085 & 3.047 & 0.902 & 0.964 & 2.716 & 25 & 50 &
-1.360 \\
120 & 4 & 0.096 & -0.515 & 4.044 & 1.586 & 0.996 & 2.519 & 25 & 50 &
-1.490 \\
\end{longtable}

\section{Visualización de
resultados}\label{visualizaciuxf3n-de-resultados}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Plot 1: Average returns by window}
\NormalTok{plot\_data }\OtherTok{\textless{}{-}}\NormalTok{ summary\_table }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(window\_days, avg\_pre\_return, avg\_post\_return) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \FunctionTok{c}\NormalTok{(avg\_pre\_return, avg\_post\_return),}
               \AttributeTok{names\_to =} \StringTok{"period"}\NormalTok{,}
               \AttributeTok{values\_to =} \StringTok{"return\_pct"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{period =} \FunctionTok{ifelse}\NormalTok{(period }\SpecialCharTok{==} \StringTok{"avg\_pre\_return"}\NormalTok{, }
                         \StringTok{"Pre{-}Election"}\NormalTok{, }\StringTok{"Post{-}Election"}\NormalTok{))}

\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(plot\_data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{factor}\NormalTok{(window\_days), }\AttributeTok{y =}\NormalTok{ return\_pct, }\AttributeTok{fill =}\NormalTok{ period)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{, }\AttributeTok{position =} \FunctionTok{position\_dodge}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.8}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"gray40"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Average USD/PEN Returns Around Elections"}\NormalTok{,}
       \AttributeTok{subtitle =} \StringTok{"By Analysis Window"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"Window (Days)"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Average Return (\%)"}\NormalTok{,}
       \AttributeTok{fill =} \StringTok{"Period"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"Pre{-}Election"} \OtherTok{=} \StringTok{"\#2E8B57"}\NormalTok{, }
                               \StringTok{"Post{-}Election"} \OtherTok{=} \StringTok{"\#CD5C5C"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{)}
\FunctionTok{print}\NormalTok{(p2)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{main_files/figure-latex/plot2-1.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Plot 2: Hit rate (frequency of expected moves)}
\NormalTok{hit\_data }\OtherTok{\textless{}{-}}\NormalTok{ summary\_table }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(window\_days, pre\_positive\_pct, post\_negative\_pct) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \FunctionTok{c}\NormalTok{(pre\_positive\_pct, post\_negative\_pct),}
               \AttributeTok{names\_to =} \StringTok{"metric"}\NormalTok{,}
               \AttributeTok{values\_to =} \StringTok{"percentage"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{metric =} \FunctionTok{ifelse}\NormalTok{(metric }\SpecialCharTok{==} \StringTok{"pre\_positive\_pct"}\NormalTok{, }
                         \StringTok{"\% Elections with Pre{-}Appreciation"}\NormalTok{,}
                         \StringTok{"\% Elections with Post{-}Depreciation"}\NormalTok{))}

\NormalTok{p3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(hit\_data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{factor}\NormalTok{(window\_days), }\AttributeTok{y =}\NormalTok{ percentage, }
                           \AttributeTok{color =}\NormalTok{ metric, }\AttributeTok{group =}\NormalTok{ metric)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{linewidth =} \FloatTok{1.2}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{50}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"gray40"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Consistency of Election Effect"}\NormalTok{,}
       \AttributeTok{subtitle =} \StringTok{"Percentage of elections following the hypothesized pattern"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"Window (Days)"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Percentage of Elections (\%)"}\NormalTok{,}
       \AttributeTok{color =} \StringTok{"Metric"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#2E8B57"}\NormalTok{, }\StringTok{"\#CD5C5C"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{100}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{)}

\FunctionTok{print}\NormalTok{(p3)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{main_files/figure-latex/unnamed-chunk-1-1.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Plot 3: Individual election outcomes (example: 60{-}day window)}
\NormalTok{individual\_data }\OtherTok{\textless{}{-}}\NormalTok{ all\_results }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(window\_days }\SpecialCharTok{==} \DecValTok{60}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{election\_label =} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{year}\NormalTok{(election\_date), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, }
                                 \FunctionTok{round}\NormalTok{(pre\_return\_pct, }\DecValTok{1}\NormalTok{), }\StringTok{"\% / "}\NormalTok{, }
                                 \FunctionTok{round}\NormalTok{(post\_return\_pct, }\DecValTok{1}\NormalTok{), }\StringTok{"\%"}\NormalTok{))}

\NormalTok{p4 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(individual\_data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ pre\_return\_pct, }\AttributeTok{y =}\NormalTok{ post\_return\_pct)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =} \FunctionTok{factor}\NormalTok{(}\FunctionTok{year}\NormalTok{(election\_date))), }\AttributeTok{size =} \DecValTok{4}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{year}\NormalTok{(election\_date)), }\AttributeTok{size =} \FloatTok{3.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"gray40"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"gray40"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Individual Election Outcomes (60{-}Day Window)"}\NormalTok{,}
       \AttributeTok{subtitle =} \StringTok{"Each point represents one election}\SpecialCharTok{\textbackslash{}n}\StringTok{Format: Year | Pre{-}Return\% / Post{-}Return\%"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"Pre{-}Election Return (\%)"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Post{-}Election Return (\%)"}\NormalTok{,}
       \AttributeTok{color =} \StringTok{"Election Year"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\FunctionTok{print}\NormalTok{(p4)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{main_files/figure-latex/unnamed-chunk-2-1.pdf}}

\section{Tests}\label{tests}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Test if pre{-}election returns are significantly \textgreater{} 0}
\CommentTok{\# and post{-}election returns significantly \textless{} 0}

\NormalTok{significance\_results }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{()}

\ControlFlowTok{for}\NormalTok{(w }\ControlFlowTok{in}\NormalTok{ windows) \{}
\NormalTok{  window\_data }\OtherTok{\textless{}{-}}\NormalTok{ all\_results }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(window\_days }\SpecialCharTok{==}\NormalTok{ w)}
  
  \ControlFlowTok{if}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(window\_data) }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{) \{}
    \CommentTok{\# Test pre{-}election returns}
\NormalTok{    pre\_test }\OtherTok{\textless{}{-}} \FunctionTok{t.test}\NormalTok{(window\_data}\SpecialCharTok{$}\NormalTok{pre\_return\_pct, }\AttributeTok{alternative =} \StringTok{"greater"}\NormalTok{)}
    
    \CommentTok{\# Test post{-}election returns  }
\NormalTok{    post\_test }\OtherTok{\textless{}{-}} \FunctionTok{t.test}\NormalTok{(window\_data}\SpecialCharTok{$}\NormalTok{post\_return\_pct, }\AttributeTok{alternative =} \StringTok{"less"}\NormalTok{)}
    
    \CommentTok{\# Test if pre \textgreater{} post (paired test)}
\NormalTok{    paired\_test }\OtherTok{\textless{}{-}} \FunctionTok{t.test}\NormalTok{(window\_data}\SpecialCharTok{$}\NormalTok{pre\_return\_pct, }
\NormalTok{                          window\_data}\SpecialCharTok{$}\NormalTok{post\_return\_pct, }
                          \AttributeTok{paired =} \ConstantTok{TRUE}\NormalTok{, }
                          \AttributeTok{alternative =} \StringTok{"greater"}\NormalTok{)}
    
\NormalTok{    significance\_results }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(}
\NormalTok{      significance\_results,}
      \FunctionTok{tibble}\NormalTok{(}
        \AttributeTok{window\_days =}\NormalTok{ w,}
        \AttributeTok{test =} \StringTok{"Pre \textgreater{} 0"}\NormalTok{,}
        \AttributeTok{p\_value =} \FunctionTok{round}\NormalTok{(pre\_test}\SpecialCharTok{$}\NormalTok{p.value, }\DecValTok{4}\NormalTok{),}
        \AttributeTok{significant =}\NormalTok{ pre\_test}\SpecialCharTok{$}\NormalTok{p.value }\SpecialCharTok{\textless{}} \FloatTok{0.05}\NormalTok{,}
        \AttributeTok{statistic =} \FunctionTok{round}\NormalTok{(pre\_test}\SpecialCharTok{$}\NormalTok{statistic, }\DecValTok{3}\NormalTok{)}
\NormalTok{      ),}
      \FunctionTok{tibble}\NormalTok{(}
        \AttributeTok{window\_days =}\NormalTok{ w,}
        \AttributeTok{test =} \StringTok{"Post \textless{} 0"}\NormalTok{, }
        \AttributeTok{p\_value =} \FunctionTok{round}\NormalTok{(post\_test}\SpecialCharTok{$}\NormalTok{p.value, }\DecValTok{4}\NormalTok{),}
        \AttributeTok{significant =}\NormalTok{ post\_test}\SpecialCharTok{$}\NormalTok{p.value }\SpecialCharTok{\textless{}} \FloatTok{0.05}\NormalTok{,}
        \AttributeTok{statistic =} \FunctionTok{round}\NormalTok{(post\_test}\SpecialCharTok{$}\NormalTok{statistic, }\DecValTok{3}\NormalTok{)}
\NormalTok{      ),}
      \FunctionTok{tibble}\NormalTok{(}
        \AttributeTok{window\_days =}\NormalTok{ w,}
        \AttributeTok{test =} \StringTok{"Pre \textgreater{} Post"}\NormalTok{,}
        \AttributeTok{p\_value =} \FunctionTok{round}\NormalTok{(paired\_test}\SpecialCharTok{$}\NormalTok{p.value, }\DecValTok{4}\NormalTok{),}
        \AttributeTok{significant =}\NormalTok{ paired\_test}\SpecialCharTok{$}\NormalTok{p.value }\SpecialCharTok{\textless{}} \FloatTok{0.05}\NormalTok{,}
        \AttributeTok{statistic =} \FunctionTok{round}\NormalTok{(paired\_test}\SpecialCharTok{$}\NormalTok{statistic, }\DecValTok{3}\NormalTok{)}
\NormalTok{      )}
\NormalTok{    )}
\NormalTok{  \}}
\NormalTok{\}}

\FunctionTok{cat}\NormalTok{(}\StringTok{"Statistical Significance Tests:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Statistical Significance Tests:
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(significance\_results)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 15 x 5
##    window_days test       p_value significant statistic
##          <dbl> <chr>        <dbl> <lgl>           <dbl>
##  1          15 Pre > 0     0.146  FALSE           1.27 
##  2          15 Post < 0    0.283  FALSE          -0.643
##  3          15 Pre > Post  0.0542 FALSE           2.27 
##  4          30 Pre > 0     0.596  FALSE          -0.266
##  5          30 Post < 0    0.213  FALSE          -0.92 
##  6          30 Pre > Post  0.320  FALSE           0.519
##  7          60 Pre > 0     0.499  FALSE           0.003
##  8          60 Post < 0    0.661  FALSE           0.459
##  9          60 Pre > Post  0.636  FALSE          -0.381
## 10          90 Pre > 0     0.608  FALSE          -0.301
## 11          90 Post < 0    0.723  FALSE           0.664
## 12          90 Pre > Post  0.776  FALSE          -0.869
## 13         120 Pre > 0     0.482  FALSE           0.048
## 14         120 Post < 0    0.852  FALSE           1.26 
## 15         120 Pre > Post  0.788  FALSE          -0.922
\end{verbatim}

\section{Cumulative return}\label{cumulative-return}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Alternative simpler version using trading days only}
\NormalTok{calculate\_cumulative\_returns\_simple }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df\_exchange, df\_elections, }\AttributeTok{max\_window =} \DecValTok{120}\NormalTok{) \{}
  \CommentTok{\# Ensure data is sorted}
\NormalTok{  df\_exchange }\OtherTok{\textless{}{-}}\NormalTok{ df\_exchange }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(date)}
  
  \CommentTok{\# List to store all election paths}
\NormalTok{  election\_paths }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
  
  \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(df\_elections)) \{}
\NormalTok{    election\_date }\OtherTok{\textless{}{-}}\NormalTok{ df\_elections}\SpecialCharTok{$}\NormalTok{date[i]}
    
    \CommentTok{\# Find exact or closest election date in exchange data}
\NormalTok{    election\_idx }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(df\_exchange}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{==}\NormalTok{ election\_date)}
    
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(election\_idx) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
      \CommentTok{\# Find the next trading day}
\NormalTok{      possible\_dates }\OtherTok{\textless{}{-}}\NormalTok{ df\_exchange}\SpecialCharTok{$}\NormalTok{date[df\_exchange}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{\textgreater{}=}\NormalTok{ election\_date]}
      \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(possible\_dates) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }\ControlFlowTok{next}
\NormalTok{      election\_idx }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(df\_exchange}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{==} \FunctionTok{min}\NormalTok{(possible\_dates))}
\NormalTok{    \}}
    
    \CommentTok{\# Check if we have enough data before and after}
    \ControlFlowTok{if}\NormalTok{(election\_idx }\SpecialCharTok{{-}}\NormalTok{ max\_window }\SpecialCharTok{\textless{}} \DecValTok{1} \SpecialCharTok{||} 
\NormalTok{       election\_idx }\SpecialCharTok{+}\NormalTok{ max\_window }\SpecialCharTok{\textgreater{}} \FunctionTok{nrow}\NormalTok{(df\_exchange)) \{}
      \ControlFlowTok{next}
\NormalTok{    \}}
    
    \CommentTok{\# Extract prices around election}
\NormalTok{    prices }\OtherTok{\textless{}{-}}\NormalTok{ df\_exchange}\SpecialCharTok{$}\NormalTok{value[(election\_idx }\SpecialCharTok{{-}}\NormalTok{ max\_window)}\SpecialCharTok{:}\NormalTok{(election\_idx }\SpecialCharTok{+}\NormalTok{ max\_window)]}
\NormalTok{    base\_price }\OtherTok{\textless{}{-}}\NormalTok{ df\_exchange}\SpecialCharTok{$}\NormalTok{value[election\_idx]}
    
    \CommentTok{\# Calculate cumulative returns}
\NormalTok{    cum\_returns }\OtherTok{\textless{}{-}}\NormalTok{ (prices }\SpecialCharTok{{-}}\NormalTok{ base\_price) }\SpecialCharTok{/}\NormalTok{ base\_price }\SpecialCharTok{*} \DecValTok{100}
    
\NormalTok{    election\_paths[[i]] }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
      \AttributeTok{election\_id =}\NormalTok{ i,}
      \AttributeTok{election\_date =}\NormalTok{ election\_date,}
      \AttributeTok{days\_relative =}\NormalTok{ (}\SpecialCharTok{{-}}\NormalTok{max\_window)}\SpecialCharTok{:}\NormalTok{max\_window,}
      \AttributeTok{cum\_return =}\NormalTok{ cum\_returns}
\NormalTok{    )}
\NormalTok{  \}}
  
  \CommentTok{\# Combine all election paths}
  \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(election\_paths) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
    \FunctionTok{return}\NormalTok{(}\FunctionTok{tibble}\NormalTok{(}\AttributeTok{days\_relative =} \FunctionTok{integer}\NormalTok{(), }\AttributeTok{avg\_cum\_return =} \FunctionTok{numeric}\NormalTok{()))}
\NormalTok{  \}}
  
\NormalTok{  all\_paths }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(election\_paths)}
  
  \CommentTok{\# Calculate summary statistics}
\NormalTok{  cumulative\_returns }\OtherTok{\textless{}{-}}\NormalTok{ all\_paths }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(days\_relative) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{summarise}\NormalTok{(}
      \AttributeTok{avg\_cum\_return =} \FunctionTok{mean}\NormalTok{(cum\_return, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{median\_cum\_return =} \FunctionTok{median}\NormalTok{(cum\_return, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{sd\_cum\_return =} \FunctionTok{sd}\NormalTok{(cum\_return, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{n\_elections =} \FunctionTok{n}\NormalTok{(),}
      \AttributeTok{cum\_return\_25 =} \FunctionTok{quantile}\NormalTok{(cum\_return, }\FloatTok{0.25}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{cum\_return\_75 =} \FunctionTok{quantile}\NormalTok{(cum\_return, }\FloatTok{0.75}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{.groups =} \StringTok{\textquotesingle{}drop\textquotesingle{}}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}
      \AttributeTok{std\_error =}\NormalTok{ sd\_cum\_return }\SpecialCharTok{/} \FunctionTok{sqrt}\NormalTok{(n\_elections),}
      \AttributeTok{ci\_lower =}\NormalTok{ avg\_cum\_return }\SpecialCharTok{{-}} \FloatTok{1.96} \SpecialCharTok{*}\NormalTok{ std\_error,}
      \AttributeTok{ci\_upper =}\NormalTok{ avg\_cum\_return }\SpecialCharTok{+} \FloatTok{1.96} \SpecialCharTok{*}\NormalTok{ std\_error,}
      \CommentTok{\# Add smoothed version}
      \AttributeTok{avg\_cum\_return\_smooth =}\NormalTok{ stats}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(avg\_cum\_return, }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\SpecialCharTok{/}\DecValTok{7}\NormalTok{, }\DecValTok{7}\NormalTok{), }\AttributeTok{sides =} \DecValTok{2}\NormalTok{)}
\NormalTok{    )}
  
  \FunctionTok{return}\NormalTok{(cumulative\_returns)}
\NormalTok{\}}

\CommentTok{\# Plot cumulative returns with enhanced visualization}
\NormalTok{plot\_cumulative\_returns }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(cumulative\_df, }\AttributeTok{max\_window =} \DecValTok{120}\NormalTok{) \{}
  \CommentTok{\# Determine y{-}axis limits with some padding}
\NormalTok{  y\_min }\OtherTok{\textless{}{-}} \FunctionTok{min}\NormalTok{(cumulative\_df}\SpecialCharTok{$}\NormalTok{ci\_lower, cumulative\_df}\SpecialCharTok{$}\NormalTok{cum\_return\_25, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{*} \FloatTok{1.1}
\NormalTok{  y\_max }\OtherTok{\textless{}{-}} \FunctionTok{max}\NormalTok{(cumulative\_df}\SpecialCharTok{$}\NormalTok{ci\_upper, cumulative\_df}\SpecialCharTok{$}\NormalTok{cum\_return\_75, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{*} \FloatTok{1.1}
  
  \CommentTok{\# Create the plot}
\NormalTok{  p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(cumulative\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ days\_relative)) }\SpecialCharTok{+}
    \CommentTok{\# Background shading for pre/post election periods}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"rect"}\NormalTok{, }\AttributeTok{xmin =} \SpecialCharTok{{-}}\NormalTok{max\_window, }\AttributeTok{xmax =} \DecValTok{0}\NormalTok{, }\AttributeTok{ymin =}\NormalTok{ y\_min, }\AttributeTok{ymax =}\NormalTok{ y\_max,}
             \AttributeTok{fill =} \StringTok{"\#2E8B57"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.05}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"rect"}\NormalTok{, }\AttributeTok{xmin =} \DecValTok{0}\NormalTok{, }\AttributeTok{xmax =}\NormalTok{ max\_window, }\AttributeTok{ymin =}\NormalTok{ y\_min, }\AttributeTok{ymax =}\NormalTok{ y\_max,}
             \AttributeTok{fill =} \StringTok{"\#CD5C5C"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.05}\NormalTok{) }\SpecialCharTok{+}
    \CommentTok{\# Confidence interval ribbon}
    \FunctionTok{geom\_ribbon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin =}\NormalTok{ ci\_lower, }\AttributeTok{ymax =}\NormalTok{ ci\_upper), }
                \AttributeTok{fill =} \StringTok{"steelblue"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.2}\NormalTok{) }\SpecialCharTok{+}
    \CommentTok{\# Interquartile range ribbon}
    \FunctionTok{geom\_ribbon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin =}\NormalTok{ cum\_return\_25, }\AttributeTok{ymax =}\NormalTok{ cum\_return\_75),}
                \AttributeTok{fill =} \StringTok{"gray70"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{) }\SpecialCharTok{+}
    \CommentTok{\# Average cumulative return line}
    \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ avg\_cum\_return), }\AttributeTok{color =} \StringTok{"steelblue"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{1.2}\NormalTok{) }\SpecialCharTok{+}
    \CommentTok{\# Smoothed line}
    \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ avg\_cum\_return\_smooth), }\AttributeTok{color =} \StringTok{"darkblue"}\NormalTok{, }
              \AttributeTok{linewidth =} \DecValTok{1}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.7}\NormalTok{) }\SpecialCharTok{+}
    \CommentTok{\# Zero lines}
    \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"solid"}\NormalTok{, }\AttributeTok{color =} \StringTok{"gray40"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"red"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
    \CommentTok{\# Add election day marker}
    \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ cumulative\_df }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(days\_relative }\SpecialCharTok{==} \DecValTok{0}\NormalTok{),}
               \FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ avg\_cum\_return), }\AttributeTok{color =} \StringTok{"red"}\NormalTok{, }\AttributeTok{size =} \DecValTok{4}\NormalTok{, }\AttributeTok{shape =} \DecValTok{19}\NormalTok{) }\SpecialCharTok{+}
    \CommentTok{\# Add text annotations}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{, }\AttributeTok{x =} \SpecialCharTok{{-}}\NormalTok{max\_window}\SpecialCharTok{/}\DecValTok{2}\NormalTok{, }\AttributeTok{y =}\NormalTok{ y\_max }\SpecialCharTok{*} \FloatTok{0.9}\NormalTok{,}
             \AttributeTok{label =} \StringTok{"PRE{-}ELECTION}\SpecialCharTok{\textbackslash{}n}\StringTok{(Expected: USD ↑)"}\NormalTok{, }
             \AttributeTok{color =} \StringTok{"\#2E8B57"}\NormalTok{, }\AttributeTok{size =} \FloatTok{4.5}\NormalTok{, }\AttributeTok{fontface =} \StringTok{"bold"}\NormalTok{, }\AttributeTok{lineheight =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{, }\AttributeTok{x =}\NormalTok{ max\_window}\SpecialCharTok{/}\DecValTok{2}\NormalTok{, }\AttributeTok{y =}\NormalTok{ y\_max }\SpecialCharTok{*} \FloatTok{0.9}\NormalTok{,}
             \AttributeTok{label =} \StringTok{"POST{-}ELECTION}\SpecialCharTok{\textbackslash{}n}\StringTok{(Expected: USD ↓)"}\NormalTok{, }
             \AttributeTok{color =} \StringTok{"\#CD5C5C"}\NormalTok{, }\AttributeTok{size =} \FloatTok{4.5}\NormalTok{, }\AttributeTok{fontface =} \StringTok{"bold"}\NormalTok{, }\AttributeTok{lineheight =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
    \CommentTok{\# Add key points annotation}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{, }\AttributeTok{x =} \SpecialCharTok{{-}}\NormalTok{max\_window, }\AttributeTok{y =}\NormalTok{ y\_min }\SpecialCharTok{*} \FloatTok{0.9}\NormalTok{,}
             \AttributeTok{label =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Pre{-}election return:"}\NormalTok{, }
                          \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%+.2f\%\%"}\NormalTok{, }
\NormalTok{                                  cumulative\_df}\SpecialCharTok{$}\NormalTok{avg\_cum\_return[cumulative\_df}\SpecialCharTok{$}\NormalTok{days\_relative }\SpecialCharTok{==} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]),}
                          \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Post{-}election return:"}\NormalTok{, }
                          \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%+.2f\%\%"}\NormalTok{, }
\NormalTok{                                  cumulative\_df}\SpecialCharTok{$}\NormalTok{avg\_cum\_return[cumulative\_df}\SpecialCharTok{$}\NormalTok{days\_relative }\SpecialCharTok{==}\NormalTok{ max\_window])),}
             \AttributeTok{color =} \StringTok{"gray30"}\NormalTok{, }\AttributeTok{size =} \FloatTok{3.5}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{lineheight =} \FloatTok{0.9}\NormalTok{) }\SpecialCharTok{+}
    \CommentTok{\# Labels and formatting}
    \FunctionTok{labs}\NormalTok{(}
      \AttributeTok{title =} \StringTok{"Cumulative USD/PEN Returns Around Peruvian Elections"}\NormalTok{,}
      \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Average across"}\NormalTok{, }\FunctionTok{unique}\NormalTok{(cumulative\_df}\SpecialCharTok{$}\NormalTok{n\_elections), }
                      \StringTok{"elections | Shaded areas: 95\% CI (blue) \& IQR (gray)"}\NormalTok{),}
      \AttributeTok{x =} \StringTok{"Trading Days Relative to Election"}\NormalTok{,}
      \AttributeTok{y =} \StringTok{"Cumulative Return (\%)"}\NormalTok{,}
      \AttributeTok{caption =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Data:"}\NormalTok{, }\FunctionTok{min}\NormalTok{(df\_elect}\SpecialCharTok{$}\NormalTok{date), }\StringTok{"to"}\NormalTok{, }\FunctionTok{max}\NormalTok{(df\_elect}\SpecialCharTok{$}\NormalTok{date),}
                     \StringTok{"| Dashed line: 7{-}day moving average"}\NormalTok{)}
\NormalTok{    ) }\SpecialCharTok{+}
    \FunctionTok{scale\_x\_continuous}\NormalTok{(}
      \AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{max\_window, max\_window, }\AttributeTok{by =} \DecValTok{30}\NormalTok{),}
      \AttributeTok{labels =} \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{paste0}\NormalTok{(x, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, }\FunctionTok{ifelse}\NormalTok{(x }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, }\StringTok{"Election"}\NormalTok{, }\StringTok{""}\NormalTok{))}
\NormalTok{    ) }\SpecialCharTok{+}
    \FunctionTok{scale\_y\_continuous}\NormalTok{(}
      \AttributeTok{labels =} \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{paste0}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%+.1f"}\NormalTok{, x), }\StringTok{"\%"}\NormalTok{),}
      \AttributeTok{breaks =}\NormalTok{ scales}\SpecialCharTok{::}\FunctionTok{pretty\_breaks}\NormalTok{(}\AttributeTok{n =} \DecValTok{10}\NormalTok{)}
\NormalTok{    ) }\SpecialCharTok{+}
    \FunctionTok{theme\_minimal}\NormalTok{(}\AttributeTok{base\_size =} \DecValTok{13}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{theme}\NormalTok{(}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{face =} \StringTok{"bold"}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \DecValTok{16}\NormalTok{),}
      \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"gray50"}\NormalTok{, }\AttributeTok{size =} \DecValTok{11}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"gray60"}\NormalTok{, }\AttributeTok{size =} \DecValTok{9}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{color =} \StringTok{"gray90"}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.3}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{0}\NormalTok{, }\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
      \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{    )}
  
  \FunctionTok{return}\NormalTok{(p)}
\NormalTok{\}}

\CommentTok{\# Calculate and plot (using the simple version which works better with your data)}
\NormalTok{cumulative\_df }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_cumulative\_returns\_simple}\NormalTok{(df\_ex\_ra, df\_elect, }\AttributeTok{max\_window =} \DecValTok{120}\NormalTok{)}

\CommentTok{\# Check if we have data}
\ControlFlowTok{if}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(cumulative\_df) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Cumulative returns calculation successful!}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Number of elections included:"}\NormalTok{, }\FunctionTok{unique}\NormalTok{(cumulative\_df}\SpecialCharTok{$}\NormalTok{n\_elections)[}\DecValTok{1}\NormalTok{], }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Date range covered:"}\NormalTok{, }\FunctionTok{min}\NormalTok{(cumulative\_df}\SpecialCharTok{$}\NormalTok{days\_relative), }\StringTok{"to"}\NormalTok{, }
      \FunctionTok{max}\NormalTok{(cumulative\_df}\SpecialCharTok{$}\NormalTok{days\_relative), }\StringTok{"days relative to election}\SpecialCharTok{\textbackslash{}n\textbackslash{}n}\StringTok{"}\NormalTok{)}
  
  \CommentTok{\# Show key statistics}
\NormalTok{  key\_stats }\OtherTok{\textless{}{-}}\NormalTok{ cumulative\_df }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(days\_relative }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{120}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{60}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{30}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{15}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{15}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{60}\NormalTok{, }\DecValTok{120}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{select}\NormalTok{(days\_relative, avg\_cum\_return, n\_elections) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{avg\_cum\_return =} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%+.2f\%\%"}\NormalTok{, avg\_cum\_return))}
  
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Key cumulative returns:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
  \FunctionTok{print}\NormalTok{(key\_stats)}
  
  \CommentTok{\# Create the plot}
\NormalTok{  p\_cumulative }\OtherTok{\textless{}{-}} \FunctionTok{plot\_cumulative\_returns}\NormalTok{(cumulative\_df, }\AttributeTok{max\_window =} \DecValTok{120}\NormalTok{)}
  
  \CommentTok{\# Display the plot}
  \FunctionTok{print}\NormalTok{(p\_cumulative)}
  
  \CommentTok{\# Additional diagnostic plot: Individual election paths}
  \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(}\FunctionTok{unique}\NormalTok{(df\_elect}\SpecialCharTok{$}\NormalTok{date)) }\SpecialCharTok{\textless{}=} \DecValTok{10}\NormalTok{) \{  }\CommentTok{\# Only if reasonable number of elections}
    \CommentTok{\# Get individual paths for plotting}
\NormalTok{    all\_paths\_list }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
    
    \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(df\_elect)) \{}
\NormalTok{      election\_date }\OtherTok{\textless{}{-}}\NormalTok{ df\_elect}\SpecialCharTok{$}\NormalTok{date[i]}
\NormalTok{      election\_idx }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(df\_ex\_ra}\SpecialCharTok{$}\NormalTok{date }\SpecialCharTok{==}\NormalTok{ election\_date)}
      
      \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(election\_idx) }\SpecialCharTok{\textgreater{}} \DecValTok{0} \SpecialCharTok{\&\&} 
\NormalTok{         election\_idx }\SpecialCharTok{{-}} \DecValTok{120} \SpecialCharTok{\textgreater{}=} \DecValTok{1} \SpecialCharTok{\&\&} 
\NormalTok{         election\_idx }\SpecialCharTok{+} \DecValTok{120} \SpecialCharTok{\textless{}=} \FunctionTok{nrow}\NormalTok{(df\_ex\_ra)) \{}
        
\NormalTok{        prices }\OtherTok{\textless{}{-}}\NormalTok{ df\_ex\_ra}\SpecialCharTok{$}\NormalTok{value[(election\_idx }\SpecialCharTok{{-}} \DecValTok{120}\NormalTok{)}\SpecialCharTok{:}\NormalTok{(election\_idx }\SpecialCharTok{+} \DecValTok{120}\NormalTok{)]}
\NormalTok{        base\_price }\OtherTok{\textless{}{-}}\NormalTok{ df\_ex\_ra}\SpecialCharTok{$}\NormalTok{value[election\_idx]}
\NormalTok{        cum\_returns }\OtherTok{\textless{}{-}}\NormalTok{ (prices }\SpecialCharTok{{-}}\NormalTok{ base\_price) }\SpecialCharTok{/}\NormalTok{ base\_price }\SpecialCharTok{*} \DecValTok{100}
        
\NormalTok{        all\_paths\_list[[i]] }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
          \AttributeTok{election\_year =} \FunctionTok{year}\NormalTok{(election\_date),}
          \AttributeTok{days\_relative =}\NormalTok{ (}\SpecialCharTok{{-}}\DecValTok{120}\NormalTok{)}\SpecialCharTok{:}\DecValTok{120}\NormalTok{,}
          \AttributeTok{cum\_return =}\NormalTok{ cum\_returns}
\NormalTok{        )}
\NormalTok{      \}}
\NormalTok{    \}}
    
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(all\_paths\_list) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
\NormalTok{      all\_paths\_df }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(all\_paths\_list)}
      
\NormalTok{      p\_individual\_paths }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(all\_paths\_df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ days\_relative, }\AttributeTok{y =}\NormalTok{ cum\_return, }
                                                     \AttributeTok{color =} \FunctionTok{factor}\NormalTok{(election\_year), }
                                                     \AttributeTok{group =}\NormalTok{ election\_year)) }\SpecialCharTok{+}
        \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{linewidth =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
        \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"gray40"}\NormalTok{) }\SpecialCharTok{+}
        \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"red"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.7}\NormalTok{) }\SpecialCharTok{+}
        \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Individual Election Paths"}\NormalTok{,}
             \AttributeTok{subtitle =} \StringTok{"Each line represents one election cycle"}\NormalTok{,}
             \AttributeTok{x =} \StringTok{"Days Relative to Election"}\NormalTok{,}
             \AttributeTok{y =} \StringTok{"Cumulative Return (\%)"}\NormalTok{,}
             \AttributeTok{color =} \StringTok{"Election Year"}\NormalTok{) }\SpecialCharTok{+}
        \FunctionTok{scale\_color\_viridis\_d}\NormalTok{(}\AttributeTok{option =} \StringTok{"plasma"}\NormalTok{) }\SpecialCharTok{+}
        \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
        \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{)}
      
      \FunctionTok{print}\NormalTok{(p\_individual\_paths)}
\NormalTok{    \}}
\NormalTok{  \}}
  
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Warning: Could not calculate cumulative returns. Check your data.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Cumulative returns calculation successful!
## Number of elections included: 4 
## Date range covered: -120 to 120 days relative to election
## 
## Key cumulative returns:
## # A tibble: 11 x 3
##    days_relative avg_cum_return n_elections
##            <int> <chr>                <int>
##  1          -120 +0.03%                   4
##  2           -60 -0.90%                   4
##  3           -30 +0.04%                   4
##  4           -15 -1.38%                   4
##  5            -1 -0.59%                   4
##  6             0 +0.00%                   4
##  7             1 -0.11%                   4
##  8            15 -0.44%                   4
##  9            30 -0.71%                   4
## 10            60 +0.92%                   4
## 11           120 +0.28%                   4
\end{verbatim}

\begin{verbatim}
## Warning: Removed 6 rows containing missing values or values outside the scale range
## (`geom_line()`).
\end{verbatim}

\pandocbounded{\includegraphics[keepaspectratio]{main_files/figure-latex/cumulative_return-1.pdf}}
\# Conclusiones

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create a final summary table}
\NormalTok{final\_summary }\OtherTok{\textless{}{-}}\NormalTok{ summary\_table }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(}
\NormalTok{    significance\_results }\SpecialCharTok{\%\textgreater{}\%} 
      \FunctionTok{filter}\NormalTok{(test }\SpecialCharTok{==} \StringTok{"Pre \textgreater{} Post"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{select}\NormalTok{(window\_days, }\AttributeTok{p\_value\_pre\_post =}\NormalTok{ p\_value, }\AttributeTok{significant\_pre\_post =}\NormalTok{ significant),}
    \AttributeTok{by =} \StringTok{"window\_days"}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(window\_days, n\_elections, avg\_pre\_return, avg\_post\_return, }
\NormalTok{         avg\_net\_effect, pre\_positive\_pct, post\_negative\_pct, }
\NormalTok{         p\_value\_pre\_post, significant\_pre\_post)}

\FunctionTok{cat}\NormalTok{(}\StringTok{"FINAL SUMMARY TABLE}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## FINAL SUMMARY TABLE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"===================}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## ===================
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{kable}\NormalTok{(final\_summary)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}
  >{\raggedleft\arraybackslash}p{(\linewidth - 16\tabcolsep) * \real{0.0839}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 16\tabcolsep) * \real{0.0839}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 16\tabcolsep) * \real{0.1049}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 16\tabcolsep) * \real{0.1119}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 16\tabcolsep) * \real{0.1049}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 16\tabcolsep) * \real{0.1189}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 16\tabcolsep) * \real{0.1259}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 16\tabcolsep) * \real{0.1189}}
  >{\raggedright\arraybackslash}p{(\linewidth - 16\tabcolsep) * \real{0.1469}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedleft
window\_days
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_elections
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
avg\_pre\_return
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
avg\_post\_return
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
avg\_net\_effect
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
pre\_positive\_pct
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
post\_negative\_pct
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p\_value\_pre\_post
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
significant\_pre\_post
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
15 & 4 & 0.702 & -0.260 & 0.962 & 100 & 50 & 0.0542 & FALSE \\
30 & 4 & -0.145 & -0.411 & 0.265 & 50 & 50 & 0.3197 & FALSE \\
60 & 4 & 0.007 & 0.500 & -0.493 & 25 & 50 & 0.6358 & FALSE \\
90 & 4 & -0.458 & 0.902 & -1.360 & 25 & 50 & 0.7756 & FALSE \\
120 & 4 & 0.096 & 1.586 & -1.490 & 25 & 50 & 0.7878 & FALSE \\
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Interpret results}
\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}n}\StringTok{INTERPRETATION:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## 
## INTERPRETATION:
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"===============}\SpecialCharTok{\textbackslash{}n\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## ===============
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(final\_summary)) \{}
\NormalTok{  row }\OtherTok{\textless{}{-}}\NormalTok{ final\_summary[i,]}
  
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"For the \%d{-}day window:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, row}\SpecialCharTok{$}\NormalTok{window\_days))}
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"{-} USD/PEN appreciated \%.2f\%\% before elections}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, row}\SpecialCharTok{$}\NormalTok{avg\_pre\_return))}
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"{-} USD/PEN depreciated \%.2f\%\% after elections}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, }\FunctionTok{abs}\NormalTok{(row}\SpecialCharTok{$}\NormalTok{avg\_post\_return)))}
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"{-} Net effect: \%.2f\%\%}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, row}\SpecialCharTok{$}\NormalTok{avg\_net\_effect))}
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"{-} \%.0f\%\% of elections showed pre{-}election appreciation}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, row}\SpecialCharTok{$}\NormalTok{pre\_positive\_pct))}
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"{-} \%.0f\%\% of elections showed post{-}election depreciation}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, row}\SpecialCharTok{$}\NormalTok{post\_negative\_pct))}
  
  \ControlFlowTok{if}\NormalTok{(row}\SpecialCharTok{$}\NormalTok{significant\_pre\_post) \{}
    \FunctionTok{cat}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"{-} Statistically significant: Pre \textgreater{} Post (p = \%.4f) }\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, row}\SpecialCharTok{$}\NormalTok{p\_value\_pre\_post))}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \FunctionTok{cat}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"{-} Not statistically significant: p = \%.4f}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, row}\SpecialCharTok{$}\NormalTok{p\_value\_pre\_post))}
\NormalTok{  \}}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## For the 15-day window:
## - USD/PEN appreciated 0.70% before elections
## - USD/PEN depreciated 0.26% after elections
## - Net effect: 0.96%
## - 100% of elections showed pre-election appreciation
## - 50% of elections showed post-election depreciation
## - Not statistically significant: p = 0.0542
## 
## For the 30-day window:
## - USD/PEN appreciated -0.14% before elections
## - USD/PEN depreciated 0.41% after elections
## - Net effect: 0.27%
## - 50% of elections showed pre-election appreciation
## - 50% of elections showed post-election depreciation
## - Not statistically significant: p = 0.3197
## 
## For the 60-day window:
## - USD/PEN appreciated 0.01% before elections
## - USD/PEN depreciated 0.50% after elections
## - Net effect: -0.49%
## - 25% of elections showed pre-election appreciation
## - 50% of elections showed post-election depreciation
## - Not statistically significant: p = 0.6358
## 
## For the 90-day window:
## - USD/PEN appreciated -0.46% before elections
## - USD/PEN depreciated 0.90% after elections
## - Net effect: -1.36%
## - 25% of elections showed pre-election appreciation
## - 50% of elections showed post-election depreciation
## - Not statistically significant: p = 0.7756
## 
## For the 120-day window:
## - USD/PEN appreciated 0.10% before elections
## - USD/PEN depreciated 1.59% after elections
## - Net effect: -1.49%
## - 25% of elections showed pre-election appreciation
## - 50% of elections showed post-election depreciation
## - Not statistically significant: p = 0.7878
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Overall conclusion}
\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{OVERALL CONCLUSION:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## OVERALL CONCLUSION:
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"===================}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## ===================
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(}\FunctionTok{mean}\NormalTok{(final\_summary}\SpecialCharTok{$}\NormalTok{avg\_pre\_return }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\textgreater{}} \FloatTok{0.8} \SpecialCharTok{\&\&} 
   \FunctionTok{mean}\NormalTok{(final\_summary}\SpecialCharTok{$}\NormalTok{avg\_post\_return }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\textgreater{}} \FloatTok{0.8}\NormalTok{) \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"The hypothesis is strongly supported by the data.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"USD/PEN consistently appreciates before elections and depreciates after.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"The effect is observable across all time windows analyzed.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{(}\FunctionTok{mean}\NormalTok{(final\_summary}\SpecialCharTok{$}\NormalTok{avg\_pre\_return }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\textgreater{}} \FloatTok{0.6} \SpecialCharTok{\&\&}
          \FunctionTok{mean}\NormalTok{(final\_summary}\SpecialCharTok{$}\NormalTok{avg\_post\_return }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\textgreater{}} \FloatTok{0.6}\NormalTok{) \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"The hypothesis is moderately supported.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"There is evidence of the pattern, but not consistently across all windows.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"The hypothesis is not well supported by the data.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"No clear pattern of pre{-}appreciation and post{-}depreciation.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## The hypothesis is not well supported by the data.
## No clear pattern of pre-appreciation and post-depreciation.
\end{verbatim}

\end{document}
